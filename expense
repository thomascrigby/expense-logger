#!/usr/bin/env python3
"""Quick expense logger - appends expenses to Google Sheets."""

import sys
import subprocess
from datetime import datetime

# Google Sheets configuration
SPREADSHEET_ID = "1cNwWQDbaNRSc3pKj-7CCSBY1zkz0m8cop3vkIHrLcF0"
SHEET_RANGE = "Sheet1!A:E"
GOG_PATH = "/opt/homebrew/bin/gog"


def log_expense(amount: str, category: str, description: str = ""):
    """Append an expense to Google Sheets."""
    now = datetime.now()
    date = now.strftime("%Y-%m-%d")
    time = now.strftime("%H:%M")

    # Format values as pipe-separated for gog sheets append
    row_values = f"{date}|{time}|{amount}|{category}|{description}"

    result = subprocess.run(
        [GOG_PATH, "sheets", "append", SPREADSHEET_ID, SHEET_RANGE, row_values],
        capture_output=True,
        text=True
    )

    if result.returncode != 0:
        print(f"Error: {result.stderr}")
        sys.exit(1)

    print(f"Logged: ${amount} [{category}] {description}")
    print(f"View at: https://docs.google.com/spreadsheets/d/{SPREADSHEET_ID}")


def show_usage():
    print("Usage: expense <amount> <category> [description]")
    print()
    print("Examples:")
    print('  expense 12.50 groceries "Coffee and bagels"')
    print("  expense 45 gas")
    print("  expense 120.00 utilities Electric bill")
    print()
    print(f"Expenses are saved to Google Sheets:")
    print(f"https://docs.google.com/spreadsheets/d/{SPREADSHEET_ID}")


if __name__ == "__main__":
    if len(sys.argv) < 3:
        show_usage()
        sys.exit(1)

    amount = sys.argv[1]
    category = sys.argv[2]
    description = " ".join(sys.argv[3:]) if len(sys.argv) > 3 else ""

    log_expense(amount, category, description)
